print("with\n    returns as (\n        select s_store_sk, i_item_sk, ss_sold_date_sk as return_date_sk\n        from store_sales\n        where ss_sold_date_sk between quarter_start_date and add_months(quarter_start_date, 3)\n    ),\n    repurchases as (\n        select s_store_sk, i_item_sk, cs_sold_date_sk as repurchase_date_sk\n        from catalog_sales\n        where cs_sold_date_sk between add_months(return_date_sk, 3) and add_months(return_date_sk, 6)\n    )\nselect s_state, i_item_sk\nfrom returns r\njoin repurchases rp on r.s_store_sk = rp.s_store_sk and r.i_item_sk = rp.i_item_sk\njoin store s on r.s_store_sk = s.s_store_sk\norder by s_state, i_item_sk;")